name: pr-info

on:
  pull_request:
    branches:
      - main

jobs:
  info:
    runs-on: ubuntu-latest
    steps:
      - name: action
        id: pr-info
        uses: Brymastr/pr-info-action@v1

      - name: Print
        run: |
          echo "${{ steps.pr-info.outputs.body }}"

      - name: Extract
        run: |
          echo "Running extract step"
          body=$(echo "${{ steps.pr-info.outputs.body }}" | tr -d '\n')
          echo $body
          substring=${body#*Automation test config}
          buildConfig="{"$(echo $substring | cut -d "{" -f2 | cut -d "}" -f1)"}"
          echo $buildConfig

      - name: Using API
        run: |
          echo "Getting from API"
          PR_INFORMATION=$(curl --request GET \
          --url https://api.github.com/repos/${{ github.repository }}/pulls/2 \
          --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
          --header 'content-type: application/json')
          PR_DESCRIPTION=$(echo $PR_INFORMATION | jq -r '.body')
          substring=${PR_DESCRIPTION#*Automation test config}
          buildConfig="{"$(echo $substring | cut -d "{" -f2 | cut -d "}" -f1)"}"
          appBranch=$(echo $buildConfig | jq -r '.appBranch')
          echo $appBranch
